<div class="card-container">
  <div class="card">
    <h2 class="title">
      {{ edicion ? 'Editar Propiedad' : 'Registrar Propiedad' }}
    </h2>

    <form [formGroup]="form" (ngSubmit)="aceptar()" class="form-grid">

      <!-- FILA 1: T칈TULO / DIRECCI칍N -->
      <div class="row">
        <mat-form-field appearance="fill" class="field">
          <mat-label>T칤tulo</mat-label>
          <input matInput formControlName="titulo" />
          <mat-error>
            @if (form.get('titulo')?.hasError('required')) {
              Ingrese titulo!!
            }
            @if (form.get('titulo')?.hasError('minlength')) {
              M칤nimo 5 caracteres
            }
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="field">
          <mat-label>Direcci칩n</mat-label>
          <input matInput formControlName="direccion" />
          <mat-error>
            @if (form.get('direccion')?.hasError('required')) {
              Ingrese direcci칩n!!
            }
          </mat-error>
        </mat-form-field>
      </div>

      <!-- FILA 2: PRECIO / ESTADO / FECHA -->
      <div class="row row-3">
        <mat-form-field appearance="fill" class="field">
          <mat-label>Precio</mat-label>
          <input matInput type="number" formControlName="precio" />
          <mat-error>
            @if (form.get('precio')?.hasError('required')) {
              Ingrese precio!!
            }
            @if (form.get('precio')?.hasError('min')) {
              Debe ser mayor a 0
            }
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="field">
          <mat-label>Estado</mat-label>
          <mat-select formControlName="estado">
            <mat-option value="Disponible">Disponible</mat-option>
            <mat-option value="No disponible">No disponible</mat-option>
          </mat-select>
          <mat-error>
            @if (form.get('estado')?.hasError('required')) {
              Seleccione estado!!
            }
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="field">
          <mat-label>Fecha publicaci칩n</mat-label>
          <input
            matInput
            [matDatepicker]="picker"
            [min]="hoy"
            [max]="hoy"
            formControlName="fechaPublicacion"
          />
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          <mat-error>
            @if (form.get('fechaPublicacion')?.hasError('required')) {
              Seleccione una fecha!!
            }
          </mat-error>
        </mat-form-field>
      </div>

      <!-- FILA 3: TIPO / CATEGOR칈A / METROS -->
      <div class="row row-3">
        <mat-form-field appearance="fill" class="field">
          <mat-label>Tipo</mat-label>
          <mat-select formControlName="tipo">
            <mat-option value="Casa">Casa</mat-option>
            <mat-option value="Departamento">Departamento</mat-option>
            <mat-option value="Terreno">Terreno</mat-option>
            <mat-option value="Local">Local</mat-option>
          </mat-select>
          <mat-error>
            @if (form.get('tipo')?.hasError('required')) {
              Seleccione un tipo!!
            }
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="field">
          <mat-label>Categor칤a</mat-label>
          <mat-select formControlName="categoria">
            <mat-option value="Venta">Venta</mat-option>
            <mat-option value="Alquiler">Alquiler</mat-option>
            <mat-option value="Proyecto">Proyecto</mat-option>
          </mat-select>
          <mat-error>
            @if (form.get('categoria')?.hasError('required')) {
              Seleccione una categor칤a!!
            }
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="field">
          <mat-label>Metros cuadrados</mat-label>
          <input matInput type="number" formControlName="metrosCuadrados" />
          <mat-error>
            @if (form.get('metrosCuadrados')?.hasError('required')) {
              Ingrese m2!!
            }
            @if (form.get('metrosCuadrados')?.hasError('min')) {
              Debe ser mayor a 0
            }
          </mat-error>
        </mat-form-field>
      </div>

      <!-- FILA 4: HABITACIONES / BA칌OS / DESTACADA -->
      <div class="row row-3 align-center">
        <mat-form-field appearance="fill" class="field">
          <mat-label>Habitaciones</mat-label>
          <input matInput type="number" formControlName="habitaciones" />
          <mat-error>
            @if (form.get('habitaciones')?.hasError('required')) {
              Ingrese n칰mero de habitaciones!!
            }
            @if (form.get('habitaciones')?.hasError('min')) {
              Debe ser mayor a 0
            }
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="field">
          <mat-label>Ba침os</mat-label>
          <input matInput type="number" formControlName="banos" />
          <mat-error>
            @if (form.get('banos')?.hasError('required')) {
              Ingrese n칰mero de ba침os!!
            }
            @if (form.get('banos')?.hasError('min')) {
              Debe ser mayor a 0
            }
          </mat-error>
        </mat-form-field>

        <div class="field toggle-field">
          <mat-slide-toggle formControlName="destacada" color="primary">
            Destacada
          </mat-slide-toggle>
        </div>
      </div>

      <!-- FILA 5: LAT / LNG -->
      <div class="row">
        <mat-form-field appearance="fill" class="field">
          <mat-label>Latitud</mat-label>
          <input matInput type="number" formControlName="latitud" />
          <mat-error>
            @if (form.get('latitud')?.hasError('required')) {
              Ingrese latitud!!
            }
            @if (form.get('latitud')?.hasError('min') || form.get('latitud')?.hasError('max')) {
              Valor entre -90 y 90
            }
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="field">
          <mat-label>Longitud</mat-label>
          <input matInput type="number" formControlName="longitud" />
          <mat-error>
            @if (form.get('longitud')?.hasError('required')) {
              Ingrese longitud!!
            }
            @if (form.get('longitud')?.hasError('min') || form.get('longitud')?.hasError('max')) {
              Valor entre -180 y 180
            }
          </mat-error>
        </mat-form-field>
      </div>

      <!-- FILA 6: URL VR -->
      <div class="row">
        <mat-form-field appearance="fill" class="field">
          <mat-label>URL VR</mat-label>
          <input matInput formControlName="urlVr" />
          <mat-error>
            @if (form.get('urlVr')?.hasError('required')) {
              Ingrese URL de VR!!
            }
          </mat-error>
        </mat-form-field>
      </div>

      <!-- FILA 7: DESCRIPCI칍N / NOTAS -->
      <div class="row">
        <mat-form-field appearance="fill" class="field">
          <mat-label>Descripci칩n</mat-label>
          <textarea matInput rows="2" formControlName="descripcion"></textarea>
          <mat-error>
            @if (form.get('descripcion')?.hasError('required')) {
              Ingrese descripci칩n!!
            }
            @if (form.get('descripcion')?.hasError('minlength')) {
              M칤nimo 10 caracteres
            }
          </mat-error>
        </mat-form-field>
      </div>

      <div class="row">
        <mat-form-field appearance="fill" class="field">
          <mat-label>Notas</mat-label>
          <textarea matInput rows="2" formControlName="notas"></textarea>
          <mat-error>
            @if (form.get('notas')?.hasError('required')) {
              Ingrese notas!!
            }
          </mat-error>
        </mat-form-field>
      </div>

      <!-- FILA 8: USUARIO / DISTRITO -->
      <div class="row">
        <mat-form-field appearance="fill" class="field">
          <mat-label>Usuario</mat-label>
          <mat-select formControlName="usuario">
            <mat-option *ngFor="let u of listaUsuarios" [value]="u.idUser">
              {{ u.nombre }} {{ u.apellido }}
            </mat-option>
          </mat-select>
          <mat-error>
            @if (form.get('usuario')?.hasError('required')) {
              Seleccione un usuario!!
            }
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="field">
          <mat-label>Distrito</mat-label>
          <mat-select formControlName="distrito">
            <mat-option *ngFor="let d of listaDistritos" [value]="d.idDistrito">
              {{ d.nombreDistrito }}
            </mat-option>
          </mat-select>
          <mat-error>
            @if (form.get('distrito')?.hasError('required')) {
              Seleccione un distrito!!
            }
          </mat-error>
        </mat-form-field>
      </div>

      <!-- IM츼GENES -->
      <div class="row row-column">
        <span class="subtitle">Im치genes</span>

        <label class="btn-upload">
          <input type="file" multiple (change)="onFileSelected($event)" />
          游늬 Elegir archivos
        </label>

        <div class="preview-row">
          <div class="preview-card" *ngFor="let img of previewImages">
            <img [src]="img" />
          </div>
        </div>
      </div>

      <!-- BOTONES -->
      <div class="actions">
        <button mat-raised-button color="primary" type="submit">
          {{ edicion ? 'Actualizar' : 'Registrar' }}
        </button>

        <button mat-raised-button color="warn" type="button" (click)="cancelar()">
          Cancelar
        </button>
      </div>
    </form>
  </div>
</div>
